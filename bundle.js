(()=>{"use strict";var t={396:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TableAnalyze=void 0;const n=s(593);class i{constructor(t){this.cellType="input",this.inputCoins=document.createElement("input"),this.inputVolts=document.createElement("input"),this.canChangeInternal=!0,this.onEnterPressed=n.noopFunc,this.inputCoins.type="number",this.inputCoins.value="0",this.inputCoins.min="0",this.inputCoins.max="15",this.inputCoins.addEventListener("keydown",(t=>{"Enter"===t.key&&(this.inputCoins.value=(0,n.clamp)(this.coins,0,15).toString(),this.inputCoins.blur(),this.inputVolts.select())})),this.inputVolts.type="number",this.inputVolts.value="0",this.inputVolts.min="0",this.inputVolts.max="5",this.inputVolts.addEventListener("keydown",(t=>{"Enter"===t.key&&(this.inputVolts.value=(0,n.clamp)(this.volts,0,5).toString(),this.inputVolts.blur(),this.onEnterPressed())})),this.element=t.insertCell(),this.element.append(this.inputCoins,this.inputVolts)}reset(){this.inputCoins.value="0",this.inputVolts.value="0"}focus(){this.inputCoins.select()}get coins(){return parseInt(this.inputCoins.value)||0}get volts(){return parseInt(this.inputVolts.value)||0}get canChange(){return this.canChangeInternal}set canChange(t){this.inputCoins.disabled=!t,this.inputVolts.disabled=!t,this.canChangeInternal=t}}class l{constructor(t,e){this.onSelectChange=e,this.cellType="analyze",this.possibleValuesInternal=15,this.solvedValueInternal=0,this.selectedValue=0,this.element=t.insertCell(),this.btnV=this.createButton(1,"0"),this.btn1=this.createButton(2,"1"),this.btn2=this.createButton(3,"2"),this.btn3=this.createButton(4,"3"),this.reset()}reset(){this.possibleValuesInternal=15,this.solvedValueInternal=0,this.selectedValue=0,this.updateButtonsStatus()}createButton(t,e){const s=document.createElement("button");return s.onclick=()=>{this.onSelectChange(this.selectedValue=t),this.updateButtonsStatus()},s.innerText=e,s.classList.add("analyze"),this.element.appendChild(s),s}updateButtonsStatus(){this.updateButtonStatus(this.btnV,1,1),this.updateButtonStatus(this.btn1,2,2),this.updateButtonStatus(this.btn2,4,3),this.updateButtonStatus(this.btn3,8,4)}updateButtonStatus(t,e,s){const n=!!(e&this.possibleValuesInternal),i=s===this.selectedValue;t.disabled=!n,1===s?t.classList.add("voltorb"):t.classList.remove("voltorb"),this.solvedValueInternal?this.solvedValueInternal===s?(t.classList.add("selected"),t.classList.remove("impossible")):(t.classList.remove("voltorb"),t.classList.remove("selected"),t.classList.add("impossible")):(1===s?t.classList.add("voltorb"):t.classList.remove("voltorb"),n?t.classList.remove("impossible"):t.classList.add("impossible"),i?t.classList.add("selected"):t.classList.remove("selected"))}get possibleValues(){return this.possibleValuesInternal}set possibleValues(t){this.possibleValuesInternal=t,this.updateButtonsStatus()}get solvedValue(){return this.solvedValueInternal}solve(t){this.solvedValueInternal=t,this.updateButtonsStatus()}}class o{constructor(t){this.cells=[],this.lastEnterPress=n.noopFunc,this.element=t.insertRow()}resetAnalyzeCells(){for(let t=0;t<this.cells.length;t++){const e=this.cells[t];"analyze"===e.cellType&&e.reset()}}resetInputs(){for(let t=0;t<this.cells.length;t++){const e=this.cells[t];"input"===e.cellType&&(e.reset(),e.canChange=!0)}}unlockInputs(){for(let t=0;t<this.cells.length;t++){const e=this.cells[t];"input"===e.cellType&&(e.canChange=!0)}}static createInputCell(t){const e=new i(t.element);this.previousInputCell&&(this.previousInputCell.onEnterPressed=()=>e.focus()),t.cells.push(e),this.previousInputCell=e}static createGoButton(t,e){const s=document.createElement("button");return s.innerText="Go!",s.style.width="48px",s.style.height="48px",s.onclick=()=>e(),t.insertCell().appendChild(s),s}static createRowCells(t,e){const s=new this(t);for(let t=0;t<5;t++)s.cells.push(new l(s.element,(s=>e(t,s))));return this.createInputCell(s),s}static createColCells(t,e){const s=new this(t);for(let t=0;t<5;t++)this.createInputCell(s);const n=this.createGoButton(s.element,e);return this.previousInputCell.onEnterPressed=()=>n.click(),s}}e.TableAnalyze=class{constructor(t){this.tableElement=document.createElement("table"),this.rows=[],this.goFunc=n.noopFunc,this.onSelect=n.noopFunc;for(let t=0;t<5;t++)this.rows.push(o.createRowCells(this.tableElement,((e,s)=>this.onSelect(e,t,s))));this.rows.push(o.createColCells(this.tableElement,(()=>this.goFunc()))),t.appendChild(this.tableElement);const e=document.createElement("div");t.appendChild(e);const s=document.createElement("button");s.innerText="Reset analysis",s.onclick=()=>this.rows.forEach((t=>t.resetAnalyzeCells())),e.appendChild(s);const i=document.createElement("button");i.innerText="Unlock input",i.onclick=()=>this.rows.forEach((t=>t.unlockInputs())),e.appendChild(i);const l=document.createElement("button");l.innerText="Reset input",l.onclick=()=>this.rows.forEach((t=>t.resetInputs())),e.appendChild(l)}coinsRow(t){return this.rows[t].cells[5].coins}voltsRow(t){return this.rows[t].cells[5].volts}coinsCol(t){return this.rows[5].cells[t].coins}voltsCol(t){return this.rows[5].cells[t].volts}outputAt(t,e){return this.rows[e].cells[t]}lockInputs(){for(let t=0;t<5;t++)this.rows[t].cells[5].canChange=!1;for(let t=0;t<5;t++)this.rows[5].cells[t].canChange=!1}setFlag(t,e,s){this.rows[e].cells[t].possibleValues=s}solve(t,e,s){this.rows[e].cells[t].solve(s)}}},198:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Analyzer=void 0,e.Analyzer=class{constructor(t,e,s){this.dict=t,this.analyzeTable=e,this.dictionaryTable=s,this.x2s=0,this.x3s=0,this.vos=0,e.goFunc=()=>this.start(),e.onSelect=(t,e,s)=>this.updateFlagsCross(t,e,this.ensureSelection(t,e,s))}start(){this.analyzeTable.lockInputs(),this.changeDictPage(),this.updateFlagsInitial()}changeDictPage(){const t=[0,1,2,3,4].map((t=>this.analyzeTable.coinsRow(t))).reduce(((t,e)=>t+e)),e=[0,1,2,3,4].map((t=>this.analyzeTable.voltsRow(t))).reduce(((t,e)=>t+e));this.currentDictPage=this.dict.getPage(t,e),this.dictionaryTable.setPage(this.currentDictPage)}getIndices(t){const e=[];return 1&t&&e.push(1),2&t&&e.push(2),4&t&&e.push(3),8&t&&e.push(4),e}getFlags(t){let e=0;for(const s of t)switch(s){case 1:e|=1;break;case 2:e|=2;break;case 3:e|=4;break;case 4:e|=8}return e}getPossibleFlags(t,e,s){let n=0;this.vos<this.currentDictPage.vosMax&&s&&(n|=1);const i=e,l=s;return i&&(this.x3s<this.currentDictPage.x3sMax&&i+l>=t+2&&i+3*l<=3*t-0&&(n|=8),this.x2s<this.currentDictPage.x2sMax&&i+l>=t+1&&i+3*l<=3*t-1&&(n|=4),i+l>=t+0&&i+3*l<=3*t-2&&(n|=2)),n}checkFlagsAndSolve(t,e,s,n){const i=this.getIndices(s);if(1===i.length){switch(this.analyzeTable.solve(t,e,i[0]),i[0]){case 3:this.currentDictPage.filterByX2(++this.x2s);break;case 4:this.currentDictPage.filterByX3(++this.x3s);break;case 1:this.vos++}n?.push({x:t,y:e})}if(0===i.length)throw new Error("Impossible initial value, check your input")}ensureSelection(t,e,s){return this.checkFlagsAndSolve(t,e,this.getFlags([s]),{push:t=>this.updateFlagsCross(t.x,t.y,0)}),s}updateFlagsCross(t,e,s){const n={row:this.analyzeTable.coinsRow(e),col:this.analyzeTable.coinsCol(t)},i={row:this.analyzeTable.voltsRow(e),col:this.analyzeTable.voltsCol(t)},l=new Set([0,1,2,3,4]),o=new Set([0,1,2,3,4]),a=(t,e)=>1===e?(i[t]-=1,!0):e>1&&(n[t]-=e-1,!0);for(const t of l.keys()){const s=this.analyzeTable.outputAt(t,e);(a("row",s.selectedValue)||a("row",s.solvedValue))&&l.delete(t)}for(const e of o.keys()){const s=this.analyzeTable.outputAt(t,e);(a("col",s.selectedValue)||a("col",s.solvedValue))&&o.delete(e)}const r=this.getPossibleFlags(l.size,n.row,i.row),c=this.getPossibleFlags(o.size,n.col,i.col),h=[];for(const t of l.keys()){const s=this.analyzeTable.outputAt(t,e).possibleValues&r;this.analyzeTable.setFlag(t,e,s),this.checkFlagsAndSolve(t,e,s,h)}for(const e of o.keys()){const s=this.analyzeTable.outputAt(t,e).possibleValues&c;this.analyzeTable.setFlag(t,e,s),this.checkFlagsAndSolve(t,e,s,h)}for(const t of h)this.updateFlagsCross(t.x,t.y,0)}updateFlagsInitial(){const t=[];for(let e=0;e<5;e++){const s=this.analyzeTable.coinsRow(e),n=this.analyzeTable.voltsRow(e);for(let i=0;i<5;i++){const l=this.analyzeTable.coinsCol(i),o=this.analyzeTable.voltsCol(i),a=this.getPossibleFlags(5,s,n)&this.getPossibleFlags(5,l,o);this.analyzeTable.setFlag(i,e,a),this.checkFlagsAndSolve(i,e,a,t)}}for(const e of t)this.updateFlagsCross(e.x,e.y,0)}}},935:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Dictionary=e.DictionaryPage=e.DictionaryItem=void 0;const n=s(593);class i{constructor(t,e,s,n){this.level=t,this.x2s=e,this.x3s=s,this.vos=n}get coins(){return 2**this.x2s*3**this.x3s}}e.DictionaryItem=i;class l{constructor(t){this.onUpdated=n.noopFunc,this.items=t??[]}static clone(t){return new this(t.items.slice())}filterByLevel(t){for(let e=0;e<this.items.length;e++)this.items[e].level!==t&&this.items.splice(e--,1);this.onUpdated()}filterByX2(t){for(let e=0;e<this.items.length;e++)this.items[e].x2s<t&&(console.log(this.items),this.items.splice(e--,1));this.onUpdated()}filterByX3(t){for(let e=0;e<this.items.length;e++)this.items[e].x3s<t&&this.items.splice(e--,1);this.onUpdated()}get x2sMax(){return Math.max(...this.items.map((t=>t.x2s)))}get x3sMax(){return Math.max(...this.items.map((t=>t.x3s)))}get vosMax(){return Math.max(...this.items.map((t=>t.vos)))}}e.DictionaryPage=l,e.Dictionary=class{constructor(){this.dict={},this.addEntry(1,0,3,6),this.addEntry(1,3,1,6),this.addEntry(1,2,2,6),this.addEntry(1,5,0,6),this.addEntry(1,4,1,6),this.addEntry(2,1,3,7),this.addEntry(2,0,4,7),this.addEntry(2,3,2,7),this.addEntry(2,6,0,7),this.addEntry(2,5,1,7),this.addEntry(3,2,3,8),this.addEntry(3,1,4,8),this.addEntry(3,4,2,8),this.addEntry(3,7,0,8),this.addEntry(3,6,1,8),this.addEntry(4,0,5,8),this.addEntry(4,3,3,8),this.addEntry(4,2,4,10),this.addEntry(4,5,2,10),this.addEntry(4,8,0,10),this.addEntry(5,1,5,10),this.addEntry(5,4,3,10),this.addEntry(5,7,1,10),this.addEntry(5,6,2,10),this.addEntry(5,9,0,10),this.addEntry(6,0,6,10),this.addEntry(6,3,4,10),this.addEntry(6,2,5,10),this.addEntry(6,5,3,10),this.addEntry(6,8,1,10),this.addEntry(7,4,4,10),this.addEntry(7,7,2,10),this.addEntry(7,6,3,10),this.addEntry(7,1,6,13),this.addEntry(7,9,1,13),this.addEntry(8,0,7,10),this.addEntry(8,2,6,10),this.addEntry(8,5,4,10),this.addEntry(8,8,2,10),this.addEntry(8,7,3,10)}addEntry(t,e,s,n){var o,a;const r=(o=this.dict)[a=function(t,e,s){return 25-(t+e+s)+2*t+3*e}(e,s,n)]??(o[a]={});(r[n]??(r[n]=new l)).items.push(new i(t,e,s,n))}getPage(t,e){return this.dict[t][e]||(console.warn(`Page doesn't exist, coins: ${t}, voltorbs: ${e}`),new l)}freeze(){Object.values(Object.freeze(this.dict)).forEach((t=>Object.values(Object.freeze(t)).forEach((t=>Object.freeze(t.items)))))}}},446:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TableDictionary=void 0,e.TableDictionary=class{constructor(t){this.tableElement=document.createElement("table"),this.nodesIndex=new Map,t.appendChild(this.tableElement),this.renderTable()}renderTable(){const t=this.tableElement.insertRow();t.insertCell().innerHTML="<b>level</b>",t.insertCell().innerHTML="<b>x2s</b>",t.insertCell().innerHTML="<b>x3s</b>",t.insertCell().innerHTML="<b>coins</b>"}renderItem(t){const e=this.tableElement.insertRow();this.nodesIndex.set(t,e.rowIndex),e.insertCell().innerText=t.level.toString(),e.insertCell().innerText=t.x2s.toString(),e.insertCell().innerText=t.x3s.toString(),e.insertCell().innerText=t.coins.toString()}removeItem(t){const e=this.nodesIndex.get(t);if(e){const s=new Map;for(const[t,e]of this.nodesIndex.entries())s.set(t,this.tableElement.rows[e]);this.tableElement.deleteRow(e),this.nodesIndex.delete(t),s.delete(t);for(const[t,e]of s.entries())this.nodesIndex.set(t,e.rowIndex)}else console.warn("Removing dictionary item that doesn't exist",t)}setPage(t){for(const t of this.nodesIndex.keys())this.removeItem(t);for(const e of t.items)this.renderItem(e);t.onUpdated=()=>{const e=new Set(this.nodesIndex.keys());for(const s of t.items)e.delete(s)||this.renderItem(s);for(const t of e.keys())this.removeItem(t)}}}},593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=e.noopFunc=void 0,e.noopFunc=()=>{},e.clamp=function(t,e,s){return Math.max(Math.min(t,s),e)}}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var l=e[n]={exports:{}};return t[n](l,l.exports,s),l.exports}(()=>{const t=s(198),e=s(396),n=s(935),i=s(446);window.analyzer=new t.Analyzer(window.dict=new n.Dictionary,window.analyzeTable=new e.TableAnalyze(document.body),window.dictionaryTable=new i.TableDictionary(document.body))})()})();
//# sourceMappingURL=bundle.js.map